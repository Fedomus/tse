(()=>{"use strict";var e={936:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(r(473)),n=r(944);t.default=class{constructor(){this.dao=new n.areasDAO}obtenerTodas(){return o(this,void 0,void 0,(function*(){try{return yield this.dao.obtenerTodos()}catch(e){i.default.error("Error en apiAreas-obtenerTodas: "+e)}}))}obtenerNombrePorId(e){return o(this,void 0,void 0,(function*(){try{return yield this.dao.obtenerNombrePorId(e)}catch(e){i.default.error("Error en apiAreas-obtenerNombrePorId: "+e)}}))}editarArea(e,t){return o(this,void 0,void 0,(function*(){return yield this.dao.actualizarDatos(e,t).then((e=>e)).catch((e=>{i.default.error("Error en editarArea: "+e)}))}))}}},575:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(r(473)),n=r(758);t.default=class{constructor(){this.pegiDAO=new n.pegiDAO}obtenerPegi(e){return o(this,void 0,void 0,(function*(){try{return e?yield this.pegiDAO.obtenerTodosPorArea(e):yield this.pegiDAO.obtenerTodos()}catch(e){i.default.error("Error en apiPegi-obtenerPegi: "+e)}}))}}},119:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(r(908)),n=a(r(614)),s=r(927),u=a(r(473)),d=a(r(809)),c=r(198);t.default=class{constructor(){this.tarjetasDAO=new i.default,this.tarjetasViewDAO=new n.default,this.tagsDAO=new s.tagsDAO,this.relacionesDAO=new d.default,this.usuariosDAO=new c.usuariosDAO}ordenarTarjetas(e){return e.sort(((e,t)=>{let r=new Date(e.tarjetasfecha);return new Date(t.tarjetasfecha)>r?1:-1})),e}obtenerTags(e){return o(this,void 0,void 0,(function*(){if(e){let t=[];for(const r of yield this.relacionesDAO.obtenerPorTarjeta(e))t.push(yield this.tagsDAO.obtenerNombrePorId(r.relaciontag));return t}}))}obtenerTarjetasAprobadas(){return o(this,void 0,void 0,(function*(){let e=this.ordenarTarjetas(yield this.tarjetasViewDAO.obtenerTarjetasAprobadas());for(const t of e)t.tarjetastags=yield this.obtenerTags(t.idtarjetas),t.tarjetasultmodusuario=yield this.usuariosDAO.obtenerNombrePorId(t.tarjetasultmodusuario);return e}))}obtenerTarjetasEvaluandose(){return o(this,void 0,void 0,(function*(){const e=this.ordenarTarjetas(yield this.tarjetasViewDAO.obtenerTarjetasEvaluandose());for(const t of e)t.tarjetastags=yield this.obtenerTags(t.idtarjetas),t.tarjetasultmodusuario=yield this.usuariosDAO.obtenerNombrePorId(t.tarjetasultmodusuario);return e}))}obtenerTarjetasRechazadas(){return o(this,void 0,void 0,(function*(){const e=this.ordenarTarjetas(yield this.tarjetasViewDAO.obtenerTarjetasRechazadas());for(const t of e)t.tarjetastags=yield this.obtenerTags(t.idtarjetas),t.tarjetasultmodusuario=yield this.usuariosDAO.obtenerNombrePorId(t.tarjetasultmodusuario);return e}))}agregarTarjeta(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.tarjetasDAO.agregarTarjeta(e).then((r=>o(this,void 0,void 0,(function*(){if("tarjeta agregada"==r){const r=yield this.tarjetasDAO.obtenerIdPorTitulo(e.tarjetastitulo);return yield this.relacionesDAO.agregarRelaciones(t,r),"tarjeta agregada"}}))))}catch(e){u.default.error("Error en apiTarjetas-agregarTarjeta: "+e)}}))}getTags(){return o(this,void 0,void 0,(function*(){try{return yield this.tagsDAO.obtenerTodos()}catch(e){u.default.error("Error en apiTarjetas-getTags: "+e)}}))}obtenerTagsOrdenados(){return o(this,void 0,void 0,(function*(){let e=[],t=yield this.getTags();for(const r of t)e.push(r.tagsnombre);return e.sort()}))}guardarCambiosYAprobar(e,t){return o(this,void 0,void 0,(function*(){try{return t.titulo&&t.cuerpo&&t.tags?(yield this.relacionesDAO.editarRelaciones(e,t.tags),yield this.tarjetasDAO.actualizarDatosYAprobar(e,t)):"campos incompletos"}catch(e){return"error"}}))}rechazarTarjeta(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.tarjetasDAO.rechazarTarjeta(e,t)}catch(e){return"error"}}))}aprobarTarjeta(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.tarjetasDAO.aprobarTarjeta(e,t)}catch(e){return"error"}}))}evaluarTarjeta(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.tarjetasDAO.evaluarTarjeta(e,t)}catch(e){return"error"}}))}}},700:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(95),n=r(198),s=r(551),u=a(r(473));t.default=class{constructor(){this.usuariosDAO=new n.usuariosDAO,this.usuariosViewDAO=new s.usuariosViewDAO}comprobarAutorizacion(e,t){return o(this,void 0,void 0,(function*(){try{return(yield this.usuariosDAO.validarNombre(e))?(yield this.usuariosDAO.validarContrasenia(e,t))?"contrasenia correcta":"contrasenia incorrecta":"nombre incorrecto"}catch(e){u.default.error("Error en apiUsuarios-comprobarAutorizacion. "+e)}}))}obtenerIdPorNombre(e){return o(this,void 0,void 0,(function*(){return(yield this.usuariosDAO.obtenerPorNombre(e)).idusuarios}))}obtenerTipoPorNombre(e){return o(this,void 0,void 0,(function*(){try{return(yield this.usuariosDAO.obtenerPorNombre(e)).usuariostipo}catch(e){u.default.error("Error en apiUsuarios-obtenerTipoPorNombre: "+e)}}))}obtenerTodos(){return o(this,void 0,void 0,(function*(){try{return yield this.usuariosViewDAO.obtenerTodos()}catch(e){u.default.error("Error en apiUsuarios-obtenerTodos: "+e)}}))}altaUsuario(e){return o(this,void 0,void 0,(function*(){try{const{nombre:t,area:r}=e;if(t&&r){if(yield this.usuariosDAO.validarNombre(t))return"ya existe";let e,o=(0,i.createHash)("temporal319");switch(r){case 6:e=2;break;case 8:e=1;break;case 18:e=1;case 17:e=4;break;case 19:e=5;break;default:e=3}const a={idusuarios:null,usuariosnombre:t,usuarioscontrasenia:o,usuariosarea:r,usuariostipo:e};return"error"==(yield this.usuariosDAO.agregarUsuario(a))?"error":"ok"}return"error"}catch(e){return u.default.error("Error en apiUsuarios-altaUsuario: "+e),"error"}}))}obtenerAreaPorNombre(e){return o(this,void 0,void 0,(function*(){return(yield this.usuariosDAO.obtenerPorNombre(e)).usuariosarea}))}actualizarPass(e,t){return o(this,void 0,void 0,(function*(){return yield this.usuariosDAO.actualizarPass(e,(0,i.createHash)(t)).then((e=>e)).catch((e=>{u.default.error("Error en apiUsuarios-actualizarPass: "+e)}))}))}}},752:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;const a=o(r(860)),i=o(r(245)),n=o(r(473)),s=o(r(1));t.App=class{constructor(e,t,r,o,i,n="/public"){this.port=e,this.modo=t,this.numCPUs=r,this.staticPath=n,this.app=(0,a.default)(),this.port=e,this.modoCluster="cluster"==t,this.numCPUs=r,this.middleware=o,this.routers=i}start(e){this.startMiddleware(this.middleware),this.assets(this.staticPath),this.setTemplateEngine(),this.startRouters(this.routers),this.listen()}startMiddleware(e){try{e.forEach((e=>{this.app.use(e)}))}catch(e){n.default.error("Error en startMiddleware: "+e)}}startRouters(e){try{e.forEach((e=>{this.app.use(e.path,e.name)}))}catch(e){n.default.error("Error en startRouters: "+e)}}assets(e){this.app.use(a.default.static(__dirname+e))}setTemplateEngine(){try{this.app.set("view engine","ejs"),this.app.set("views","./src/views"),this.app.locals.moment=i.default}catch(e){n.default.error("Error en setTemplateEngine: "+e)}}listen(){if(this.modoCluster&&s.default.isPrimary){n.default.info(`Número de procesadores: ${this.numCPUs}`),n.default.info(`PID Máster: ${process.pid}`);for(let e=0;e<this.numCPUs;e++)s.default.fork();s.default.on("exit",(e=>{n.default.info(`Worker ${e.process.pid} died ${(new Date).toLocaleString()}`),s.default.fork()}))}else try{this.app.listen(this.port),n.default.info(`PID Worker ${process.pid}. Servidor escuchando en puerto ${this.port}`)}catch(e){n.default.error(`Error en el servidor: ${e}`)}}}},226:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(r(575)),n=a(r(119)),s=a(r(700)),u=a(r(936)),d=a(r(473));t.default=class{constructor(){this.apiPegi=new i.default,this.apiTarjetas=new n.default,this.apiUsuarios=new s.default,this.apiAreas=new u.default}getGGAdministracion(e,t){return o(this,void 0,void 0,(function*(){try{const r=yield this.apiUsuarios.obtenerTodos(),o=yield this.apiAreas.obtenerTodas(),a=yield this.apiTarjetas.obtenerTarjetasEvaluandose(),i=yield this.apiTarjetas.obtenerTarjetasAprobadas(),n=yield this.apiTarjetas.obtenerTarjetasRechazadas(),s=yield this.apiTarjetas.obtenerTagsOrdenados();return t.render("../views/pages/administracion.ejs",{usuarioLogueado:e.session.usuarioLogueado,usuario:e.session.usuario,usuarios:r,areas:o,tags:s.sort(),tipo:e.session.tipo,tarjetas:a,tarjetasAprobadas:i,tarjetasRechazadas:n,error:!1})}catch(e){return d.default.error("Error en getGGAdministracion: "+e),t.json({result:"error en el servidor"})}}))}postAlta(e,t){return o(this,void 0,void 0,(function*(){try{const r=e.body;let o=yield this.apiUsuarios.altaUsuario(r);if("ok"==o)return t.status(200).redirect("/admin");if("ya existe"==o)return t.status(201).json({result:"ya existe el usuario"})}catch(e){return d.default.error("Error en postAlta: "+e),t.json({result:"error en el servidor"})}}))}}},847:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(r(936)),n=a(r(473));t.default=class{constructor(){this.apiAreas=new i.default}getAreas(e,t){return o(this,void 0,void 0,(function*(){try{const e=yield this.apiAreas.obtenerTodas();t.json(e)}catch(e){return n.default.error("Error en getAreas: ",e),t.json({result:"error en el servidor"})}}))}editarArea(e,t){return o(this,void 0,void 0,(function*(){try{let r=e.params.id,o=e.body;if(o.nombre&&o.iniciales)return yield this.apiAreas.editarArea(r,o).then((e=>{if("ok"==e)return t.status(200).redirect("/admin")}))}catch(e){return n.default.error("error en editarArea: "+e),t.json({result:"error en el servidor"})}}))}}},14:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(r(936)),n=a(r(700)),s=a(r(473));t.default=class{constructor(){this.api=new n.default,this.apiAreas=new i.default}getLogin(e,t){return o(this,void 0,void 0,(function*(){try{return t.render("../views/pages/login.ejs",{usuarioLogueado:!1,error:!1,tipo:null})}catch(e){return s.default.error("Error en getLogin: "+e),t.json({result:"error en el servidor"})}}))}postLogin(e,t){return o(this,void 0,void 0,(function*(){try{const{nombre:r,contrasenia:o}=e.body;if(!r||!o)return t.render("../views/pages/login",{usuarioLogueado:e.session.usuarioLogueado||!1,usuario:e.session.usuario||null,error:"Debe completar todos los campos."});switch(yield this.api.comprobarAutorizacion(r,o)){case"nombre incorrecto":return t.render("../views/pages/login",{usuarioLogueado:e.session.usuarioLogueado||!1,usuario:e.session.usuario||null,error:"Nombre de usuario incorrecto"});case"contrasenia incorrecta":return t.render("../views/pages/login",{usuarioLogueado:e.session.usuarioLogueado||!1,usuario:e.session.usuario||null,error:"Contraseña incorrecta"});case"contrasenia correcta":return e.session.usuario=r,e.session.tipo=yield this.api.obtenerTipoPorNombre(r),e.session.area=yield this.api.obtenerAreaPorNombre(r),e.session.usuarioLogueado=!0,e.session.save(),t.redirect("/tse")}}catch(e){return s.default.error("Error en postLogin: "+e),t.json({result:"error en el servidor"})}}))}getLogout(e,t){return o(this,void 0,void 0,(function*(){try{return e.session.destroy((e=>{e&&t.send({status:"Logout Error",body:e})})),t.redirect("/")}catch(e){return s.default.error("Error en getLogout: "+e),t.json({result:"error en el servidor"})}}))}getSessionData(e,t){return o(this,void 0,void 0,(function*(){try{return t.json({area:e.session.area})}catch(e){return s.default.error("Error en getSessionData: "+e),t.json({result:"error en el servidor"})}}))}postNewPass(e,t){return o(this,void 0,void 0,(function*(){try{const{pass:r,newPass:o,newPass2:a}=e.body,{usuario:i}=e.session;if(r&&o&&a&&i&&o==a){const e=yield this.api.comprobarAutorizacion(i,r);if("contrasenia correcta"==e)return yield this.api.actualizarPass(i,o).then((e=>{if("ok"==e)return t.status(200).redirect("/tse")}));if("contrasenia incorrecta"==e)return t.status(201).json({result:"contrasenia incorrecta"})}}catch(e){return s.default.error("Error en postNewPass: "+e),t.json({result:"error en el servidor"})}}))}}},856:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(r(473));t.default=class{getHome(e,t){return o(this,void 0,void 0,(function*(){try{return t.render("../views/pages/home",{usuarioLogueado:e.session.usuarioLogueado,usuario:e.session.usuario,tipo:e.session.tipo})}catch(e){return i.default.error("Error en getHome: "+e),t.json({result:"error en el servidor"})}}))}}},312:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(r(575)),n=a(r(473));t.default=class{constructor(){this.api=new i.default}getPegi(e,t){return o(this,void 0,void 0,(function*(){try{let e=yield this.api.obtenerPegi(),r=this.convertirData(e);return r={ejes:this.quitarDuplicados(r.ejes,"idejes"),objetivos:this.quitarDuplicados(r.objetivos,"idobjetivos"),lineas:this.quitarDuplicados(r.lineas,"idlineas"),planesDeAccion:this.quitarDuplicados(r.planesDeAccion,"idplanesdeaccion")},t.json(r)}catch(e){return n.default.error("Error en getPegi: "+e),t.json({result:"error en el servidor"})}}))}convertirData(e){try{let t=[],r=[],o=[],a=[];for(const i of e)t.push({idejes:i.idejes,ejesnombre:i.ejesnombre}),r.push({idobjetivos:i.idobjetivos,objetivosnombre:i.objetivosnombre,objetivoseje:i.objetivoseje}),o.push({idlineas:i.idlineas,lineasnombre:i.lineasnombre,lineasobjetivo:i.lineasobjetivo}),a.push({idplanesdeaccion:i.idplanesdeaccion,planesdeaccionnombre:i.planesdeaccionnombre,planesdeaccionlinea:i.planesdeaccionlinea,planesdeaccionarea:i.planesdeaccionarea,areasnombre:i.areasnombre,areasdescripcion:i.areasdescripcion});return{ejes:t,objetivos:r,lineas:o,planesDeAccion:a}}catch(e){return n.default.error("Error en convertirData: "+e),{ejes:[],objetivos:[],lineas:[],planesDeAccion:[]}}}quitarDuplicados(e,t){try{if(e){let r=[];r.push(e[0]);for(let o of e)void 0===r.find((e=>e[t]===o[t]))&&r.push(o);return r}}catch(e){n.default.error("Error en quitarDuplicados: "+e)}}getPegiFiltrado(e,t){return o(this,void 0,void 0,(function*(){try{let r=e.session.area,o=yield this.api.obtenerPegi(r),a=this.convertirData(o);return a={ejes:this.quitarDuplicados(a.ejes,"idejes"),objetivos:this.quitarDuplicados(a.objetivos,"idobjetivos"),lineas:this.quitarDuplicados(a.lineas,"idlineas"),planesDeAccion:this.quitarDuplicados(a.planesDeAccion,"idplanesdeaccion")},t.json(a)}catch(e){return n.default.error("Error en getPegiFiltrado: "+e),t.json({result:"error en el servidor"})}}))}descargarPegi(e,t){return o(this,void 0,void 0,(function*(){try{const e=`${__dirname}/public/files/IF-2022-62930192-APN-GG%INCAA.pdf`;t.download(e)}catch(e){n.default.error("Error en descargarPegi: "+e)}}))}descargarNorma(e,t){return o(this,void 0,void 0,(function*(){try{const e=`${__dirname}/public/files/RS-2022-71880387-APN-INCAA%MC.pdf`;t.download(e)}catch(e){n.default.error("Error en descargarNorma: "+e)}}))}}},22:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(r(936)),n=a(r(119)),s=a(r(700)),u=a(r(473));t.default=class{constructor(){this.apiTarjetas=new n.default,this.apiUsuarios=new s.default,this.apiAreas=new i.default}getTarjetasAprobadas(e,t){return o(this,void 0,void 0,(function*(){try{const e=yield this.apiTarjetas.obtenerTarjetasAprobadas();return t.json(e)}catch(e){return u.default.error("Error en getTarjetasAprobadas: "+e),t.status(202).json({result:"error en el servidor"})}}))}postNuevaTarjeta(e,t){return o(this,void 0,void 0,(function*(){const{eje:r,objetivo:o,linea:a,plandeaccion:i,titulo:n,cuerpo:s,expediente:d,actoadministrativo:c,tags:l}=e.body,h=e.session.usuario;if(r&&o&&a&&i&&n&&s&&l&&h){const e=yield this.apiUsuarios.obtenerAreaPorNombre(h),f=yield this.apiUsuarios.obtenerIdPorNombre(h);if(f){const h={idtarjetas:void 0,tarjetastitulo:n,tarjetascuerpo:s,tarjetasautor:f,tarjetasareas:e,tarjetasexpediente:d,tarjetasactoadministrativo:c,tarjetasejes:r,tarjetasobjetivos:o,tarjetaslineas:a,tarjetasplandeaccion:i,tarjetasestado:2,tarjetasfecha:new Date,tarjetasultmodusuario:f};return yield this.apiTarjetas.agregarTarjeta(h,l).then((e=>{if("tarjeta agregada"==e)return t.status(200).redirect("/tse")})).catch((e=>(u.default.error("Error en postNuevaTarjeta: "+e),t.status(202).json({result:"error en el servidor"}))))}}}))}guardarCambiosYAprobar(e,t){return o(this,void 0,void 0,(function*(){let r=parseInt(e.params.id),o=e.body,a=e.session.usuario;if(o.titulo&&o.cuerpo&&o.tags&&a){let e=yield this.apiUsuarios.obtenerIdPorNombre(a);return o.usuario=e,yield this.apiTarjetas.guardarCambiosYAprobar(r,o).then((e=>{if("ok"==e)return t.status(200).redirect("/admin")})).catch((e=>(u.default.error("Error en guardarCambiosYAprobar: "+e),t.status(202).json({result:"error en el servidor"}))))}}))}rechazarTarjeta(e,t){return o(this,void 0,void 0,(function*(){let r=parseInt(e.params.id),o=e.session.usuario;if(o){let e=yield this.apiUsuarios.obtenerIdPorNombre(o);return yield this.apiTarjetas.rechazarTarjeta(r,e).then((e=>{if("ok"==e)return t.status(200).redirect("/admin")})).catch((e=>(u.default.error("Error en rechazarTarjeta: "+e),t.status(202).json({result:"error en el servidor"}))))}}))}aprobarTarjeta(e,t){return o(this,void 0,void 0,(function*(){let r=parseInt(e.params.id),o=e.session.usuario;if(o){let e=yield this.apiUsuarios.obtenerIdPorNombre(o);return yield this.apiTarjetas.aprobarTarjeta(r,e).then((e=>{if("ok"==e)return t.status(200).redirect("/admin")})).catch((e=>(u.default.error("Error en aprobarTarjeta: "+e),t.status(202).json({result:"error en el servidor"}))))}}))}evaluarTarjeta(e,t){return o(this,void 0,void 0,(function*(){let r=e.session.usuario,o=parseInt(e.params.id);if(r){let e=yield this.apiUsuarios.obtenerIdPorNombre(r);return yield this.apiTarjetas.evaluarTarjeta(o,e).then((e=>{if("ok"==e)return t.status(200).redirect("/admin")})).catch((e=>(u.default.error("Error en evaluarTarjeta: "+e),t.status(202).json({result:"error en el servidor"}))))}}))}}},696:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(r(119)),n=a(r(473)),s=a(r(936));t.default=class{constructor(){this.apiTarjetas=new i.default,this.apiAreas=new s.default}getTse(e,t){return o(this,void 0,void 0,(function*(){try{const r=yield this.apiTarjetas.obtenerTagsOrdenados(),o=yield this.apiAreas.obtenerTodas();return t.render("../views/pages/tse.ejs",{usuarioLogueado:e.session.usuarioLogueado,usuario:e.session.usuario,tipo:e.session.tipo,areas:o,tags:r,error:!1})}catch(e){return n.default.error("Error en getTse: "+e),t.json({result:"Error en el servidor"})}}))}getNewPass(e,t){return o(this,void 0,void 0,(function*(){try{return t.render("../views/pages/contrasenia",{usuarioLogueado:e.session.usuarioLogueado,usuario:e.session.usuario,tipo:e.session.tipo,error:!1})}catch(e){return n.default.error("Error en getNewPass: "+e),t.json({result:"Error en el servidor"})}}))}}},397:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ENV=void 0,o(r(142)).default.config(),t.ENV={stage:"production",PORT:process.env.PORT,DB_PORT:process.env.DB_PORT,DB_HOST:process.env.DB_HOST,DB_USER:process.env.DB_USER,DB_PASS:process.env.DB_PASS,DB_NAME:process.env.DB_NAME,SECRET:process.env.SESSION_SECRET,KEY:process.env.SESSION_KEY}},473:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,a)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const n=i(r(94));n.configure({appenders:{loggerConsole:{type:"console"},loggerWarn:{type:"file",filename:"./src/log/warn.log"},loggerError:{type:"file",filename:"./src/log/error.log"}},categories:{default:{appenders:["loggerConsole"],level:"debug"},consola:{appenders:["loggerConsole"],level:"error"},warn:{appenders:["loggerWarn"],level:"warn"},error:{appenders:["loggerError"],level:"error"}}});const s=n.getLogger();t.default=s},409:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.midGG=t.midGeneral=void 0,t.midGeneral=function(e,t,r){if(!e.session.usuarioLogueado)return t.redirect("/auth/login");r()},t.midGG=function(e,t,r){if(2!=e.session.tipo)return t.redirect("/");r()}},327:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,a)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return a(t,e),t},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.middlewareGlobal=void 0;const s=n(r(508)),u=n(r(986)),d=n(r(582)),c=n(r(455)),l=r(397),h=i(r(508)),f=n(r(860)),p=n(r(283)),v=n(r(806)),b=n(r(473)),y=new((0,p.default)(h))({host:l.ENV.DB_HOST,port:l.ENV.DB_PORT,user:l.ENV.DB_USER,password:l.ENV.DB_PASS,database:l.ENV.DB_NAME});let j;l.ENV.KEY&&l.ENV.SECRET?j={key:l.ENV.KEY,secret:l.ENV.SECRET,store:y,resave:!1,saveUninitialized:!1}:b.default.error("Falta configurar SESSION_KEY y SESSION_SECRET"),t.middlewareGlobal=[u.default.json(),u.default.urlencoded({extended:!0}),f.default.urlencoded({extended:!0}),(0,d.default)(),(0,v.default)({contentSecurityPolicy:!1}),(0,c.default)(),(0,s.default)(j),(e,t,r,o)=>{!function(e,t,r,o){if(e)return r.status(e.statusCode||500).json(e.message);o()}(e,0,r,o)}]},944:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.areasDAO=void 0;const i=a(r(473)),n=a(r(120));class s extends n.default{constructor(){super("areas")}obtenerTodos(){return o(this,void 0,void 0,(function*(){try{return yield this.getAll()}catch(e){i.default.error("Error en areasDAO-obtenerTodos. "+e)}}))}obtenerNombrePorId(e){return o(this,void 0,void 0,(function*(){try{let t;return yield this.knex(this.tabla).where({idareas:e}).then((e=>{e&&(t=e.areasnombre)})),t}catch(e){i.default.error("Error en areasDAO-obtenerNombrePorId: "+e)}}))}actualizarDatos(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.knex(this.tabla).where({idareas:e}).update({areasnombre:t.iniciales,areasdescripcion:t.nombre}),"ok"}catch(e){return i.default.error("Error en areasDAO-actualizarDatos: "+e),"error"}}))}}t.areasDAO=s},758:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.pegiDAO=void 0;const i=a(r(473)),n=a(r(120));class s extends n.default{constructor(){super("pegi")}obtenerTodosPorArea(e){return o(this,void 0,void 0,(function*(){try{return(yield this.getAll()).filter((t=>t.idareas==e))}catch(e){i.default.error("Error en pegiDAO-obtenerTodosPorArea: "+e)}}))}obtenerTodos(){return o(this,void 0,void 0,(function*(){try{return yield this.getAll()}catch(e){i.default.error("Error en pegiDAO-obtenerTodos: "+e)}}))}}t.pegiDAO=s},809:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(r(473)),n=a(r(120)),s=r(927);class u extends n.default{constructor(){super("relaciones"),this.tagsDAO=new s.tagsDAO}agregarRelaciones(e,t){return o(this,void 0,void 0,(function*(){try{for(const r of e){const e=yield this.tagsDAO.obtenerIdPorNombre(r);this.save({idrelacion:null,relaciontarjeta:t,relaciontag:e})}}catch(e){i.default.error("Error en relacionesDAO - agregarRelacion: "+e)}}))}editarRelaciones(e,t){return o(this,void 0,void 0,(function*(){this.knex(this.tabla).where({relaciontarjeta:e}).del().then((()=>o(this,void 0,void 0,(function*(){for(const r of t){const t=yield this.tagsDAO.obtenerIdPorNombre(r);this.save({idrelacion:null,relaciontag:t,relaciontarjeta:e})}})))).catch((e=>{i.default.error("Error en relacionesDAO- editarRelaciones: "+e)}))}))}obtenerPorTarjeta(e){return o(this,void 0,void 0,(function*(){try{return this.knex(this.tabla).where({relaciontarjeta:e})}catch(e){i.default.error("Error en relacionesDAO- obtenerPorTarjeta: "+e)}}))}}t.default=u},927:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.tagsDAO=void 0;const i=a(r(473)),n=a(r(120));class s extends n.default{constructor(){super("tags")}obtenerTodos(){return o(this,void 0,void 0,(function*(){try{return yield this.getAll()}catch(e){i.default.error("Error en tagsDAO-obtenerTodos: "+e)}}))}obtenerIdPorNombre(e){return o(this,void 0,void 0,(function*(){try{return this.knex(this.tabla).where({tagsnombre:e}).first().then((e=>e.idtags))}catch(e){i.default.error("Error en tagsDAO-obtenerIdPorNombre: "+e)}}))}obtenerNombrePorId(e){return o(this,void 0,void 0,(function*(){try{return this.knex(this.tabla).where({idTags:e}).first().then((e=>e.tagsnombre))}catch(e){i.default.error("Error en tagsDAO-obtenerNombrePorId: "+e)}}))}}t.tagsDAO=s},908:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(r(120)),n=a(r(473));class s extends i.default{constructor(){super("tarjetas")}agregarTarjeta(e){return o(this,void 0,void 0,(function*(){try{return yield this.save(e),"tarjeta agregada"}catch(e){n.default.error("Error en tarjetasDAO-agregarTarjeta: "+e)}}))}actualizarDatosYAprobar(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.knex(this.tabla).where({idtarjetas:e}).update({tarjetastitulo:t.titulo,tarjetascuerpo:t.cuerpo,tarjetasexpediente:t.expediente,tarjetasactoadministrativo:t.actoadministrativo,tarjetasestado:1,tarjetasultmodusuario:t.usuario}),"ok"}catch(e){return n.default.error("Error en tarjetasDAO-actualizarDatosYAprobar: "+e),"error"}}))}aprobarTarjeta(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.knex(this.tabla).where({idtarjetas:e}).update({tarjetasestado:1,tarjetasultmodusuario:t}),"ok"}catch(e){return n.default.error("Error en tarjetasDAO-aprobarTarjeta: "+e),"error"}}))}rechazarTarjeta(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.knex(this.tabla).where({idtarjetas:e}).update({tarjetasestado:0,tarjetasultmodusuario:t}),"ok"}catch(e){return n.default.error("Error en tarjetasDAO-rechazarTarjeta: "+e),"error"}}))}evaluarTarjeta(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.knex(this.tabla).where({idtarjetas:e}).update({tarjetasestado:2,tarjetasultmodusuario:t}),"ok"}catch(e){return n.default.error("Error en tarjetasDAO-evaluarTarjeta: "+e),"error"}}))}obtenerIdPorTitulo(e){return o(this,void 0,void 0,(function*(){return yield this.knex(this.tabla).where({tarjetastitulo:e}).first().then((e=>e.idtarjetas))}))}}t.default=s},614:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(r(120)),n=a(r(473));class s extends i.default{constructor(){super("tarjetas_view")}obtenerTarjetas(){return o(this,void 0,void 0,(function*(){try{return yield this.getAll()}catch(e){n.default.error("Error en tarjetasViewDAO-obtenerTarjetas: "+e)}}))}obtenerTarjetasAprobadas(){return o(this,void 0,void 0,(function*(){try{return(yield this.getAll()).filter((e=>1==e.tarjetasestado))}catch(e){n.default.error("Error en tarjetasViewDAO-obtenerTarjetasAprobadas: "+e)}}))}obtenerTarjetasEvaluandose(){return o(this,void 0,void 0,(function*(){try{return(yield this.getAll()).filter((e=>2==e.tarjetasestado))}catch(e){n.default.error("Error en tarjetasViewDAO-obtenerTarjetasEvaluandose: "+e)}}))}obtenerTarjetasRechazadas(){return o(this,void 0,void 0,(function*(){try{return(yield this.getAll()).filter((e=>0==e.tarjetasestado))}catch(e){n.default.error("Error en tarjetasViewDAO-obtenerTarjetasRechazadas: "+e)}}))}}t.default=s},198:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.usuariosDAO=void 0;const i=a(r(120)),n=r(85),s=a(r(473));class u extends i.default{constructor(){super("usuarios")}obtenerPorNombre(e){return o(this,void 0,void 0,(function*(){try{let t;return yield this.knex(this.tabla).where({usuariosnombre:e}).first().then((e=>(t=e||void 0,t)))}catch(e){s.default.error("Error en usuariosDAO-obtenerPorNombre: "+e)}}))}obtenerPorId(e){return o(this,void 0,void 0,(function*(){try{let t;return yield this.knex(this.tabla).where({idusuarios:e}).first().then((e=>(t=e||null,t)))}catch(e){s.default.error("Error en usuariosDAO-obtenerPorId: "+e)}}))}obtenerNombrePorId(e){return o(this,void 0,void 0,(function*(){return yield this.obtenerPorId(e).then((e=>e.usuariosnombre))}))}validarNombre(e){return o(this,void 0,void 0,(function*(){try{return yield this.knex(this.tabla).where({usuariosnombre:e}).first().then((e=>!!e))}catch(e){s.default.error("Error en usuariosDAO-validarNombre: "+e)}}))}validarContrasenia(e,t){return o(this,void 0,void 0,(function*(){try{const r=yield this.obtenerPorNombre(e);return!!(0,n.contraseniaValida)(r,t)}catch(e){s.default.error("Error en usuariosDAO-validarContrasenia: "+e)}}))}agregarUsuario(e){return o(this,void 0,void 0,(function*(){try{return yield this.save(e),"usuario agregado"}catch(e){return s.default.error("Error en usuariosDAO-agregarUsuario: "+e),"error"}}))}obtenerTodos(){return o(this,void 0,void 0,(function*(){try{return yield this.getAll()}catch(e){s.default.error("Error en usuariosDAO-obtenerTodos: "+e)}}))}actualizarPass(e,t){return o(this,void 0,void 0,(function*(){return yield this.knex(this.tabla).where({usuariosnombre:e}).first().update({usuarioscontrasenia:t}).then((e=>e?"ok":"no se encontro usuario")).catch((e=>(s.default.error("Error en usuariosDAO-actualizarPass: "+e),"error")))}))}}t.usuariosDAO=u},551:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.usuariosViewDAO=void 0;const i=a(r(120));class n extends i.default{constructor(){super("usuarios_view")}obtenerTodos(){return o(this,void 0,void 0,(function*(){return yield this.getAll()}))}}t.usuariosViewDAO=n},120:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function s(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(397),n=a(r(473)),s=a(r(514));let u;try{u=(0,s.default)({client:"mysql",connection:{host:i.ENV.DB_HOST,port:i.ENV.DB_PORT,user:i.ENV.DB_USER,password:i.ENV.DB_PASS,database:i.ENV.DB_NAME}}),n.default.info("PID Worker "+process.pid+". Base de datos conectada.")}catch(e){n.default.error(`Error en la conexión a la base de datos: ${e}`)}t.default=class{constructor(e){this.knex=u,this.tabla=e}save(e){return o(this,void 0,void 0,(function*(){yield this.knex(this.tabla).insert(e).catch((e=>n.default.error("Error en save: "+e)))}))}getAll(){return o(this,void 0,void 0,(function*(){return yield this.knex(this.tabla).select("*").then((e=>e)).catch((e=>{n.default.error("Error en getAll: "+e)}))}))}}},274:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=o(r(856)),i=o(r(14)),n=o(r(696)),s=r(860),u=o(r(312)),d=o(r(22)),c=r(409),l=o(r(226)),h=o(r(847));t.default=class{constructor(){this.authController=new i.default,this.tseController=new n.default,this.pegiController=new u.default,this.tarjetasController=new d.default,this.adminController=new l.default,this.homeController=new a.default,this.areasController=new h.default}home(){const e=(0,s.Router)();return e.get("/",((e,t)=>{this.homeController.getHome(e,t)})),e}auth(){const e=(0,s.Router)();return e.get("/login",((e,t)=>{this.authController.getLogin(e,t)})),e.post("/login",((e,t)=>{this.authController.postLogin(e,t)})),e.post("/newpass",((e,t)=>{this.authController.postNewPass(e,t)})),e.get("/logout",((e,t)=>{this.authController.getLogout(e,t)})),e}tse(){const e=(0,s.Router)();return e.use(c.midGeneral),e.get("/",((e,t)=>{this.tseController.getTse(e,t)})),e.get("/descargarpegi",((e,t)=>{this.pegiController.descargarPegi(e,t)})),e.get("/descargarnorma",((e,t)=>{this.pegiController.descargarNorma(e,t)})),e.post("/nuevo",((e,t)=>{this.tarjetasController.postNuevaTarjeta(e,t)})),e.get("/newpass",((e,t)=>{this.tseController.getNewPass(e,t)})),e}admin(){const e=(0,s.Router)();return e.use(c.midGG),e.get("/",((e,t)=>{this.adminController.getGGAdministracion(e,t)})),e.post("/alta",((e,t)=>{this.adminController.postAlta(e,t)})),e.post("/hito/guardaryaprobar/:id",((e,t)=>{this.tarjetasController.guardarCambiosYAprobar(e,t)})),e.post("/hito/rechazar/:id",((e,t)=>{this.tarjetasController.rechazarTarjeta(e,t)})),e.post("/hito/aprobar/:id",((e,t)=>{this.tarjetasController.aprobarTarjeta(e,t)})),e.post("/hito/evaluar/:id",((e,t)=>{this.tarjetasController.evaluarTarjeta(e,t)})),e.post("/areas/:id",((e,t)=>{this.areasController.editarArea(e,t)})),e}api(){const e=(0,s.Router)();return e.get("/pegi",c.midGeneral,((e,t)=>{this.pegiController.getPegi(e,t)})),e.get("/pegi2",c.midGeneral,((e,t)=>{this.pegiController.getPegiFiltrado(e,t)})),e.get("/tarjetas",c.midGeneral,((e,t)=>{this.tarjetasController.getTarjetasAprobadas(e,t)})),e.get("/sessiondata",c.midGeneral,((e,t)=>{this.authController.getSessionData(e,t)})),e.get("/areas",((e,t)=>this.areasController.getAreas(e,t))),e}}},728:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(752),i=r(327),n=o(r(274)),s=o(r(566)),u=o(r(37)),d={alias:{p:"port",m:"modo"},default:{port:r(397).ENV.PORT,modo:"cluster"}},c=(0,s.default)(process.argv.slice(2),d),l=c.p,h=c.m,f=u.default.cpus().length,p=new n.default;new a.App(l,h,f,i.middlewareGlobal,[{path:"/",name:p.home()},{path:"/auth",name:p.auth()},{path:"/tse",name:p.tse()},{path:"/api",name:p.api()},{path:"/admin",name:p.admin()}]).start()},95:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createHash=void 0;const a=o(r(96));t.createHash=function(e){return a.default.hashSync(e,a.default.genSaltSync(10))}},85:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.contraseniaValida=void 0;const a=o(r(96));t.contraseniaValida=function(e,t){return a.default.compareSync(t,e.usuarioscontrasenia)}},96:e=>{e.exports=require("bcrypt")},986:e=>{e.exports=require("body-parser")},455:e=>{e.exports=require("compression")},582:e=>{e.exports=require("cors")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},283:e=>{e.exports=require("express-mysql-session")},508:e=>{e.exports=require("express-session")},806:e=>{e.exports=require("helmet")},514:e=>{e.exports=require("knex")},94:e=>{e.exports=require("log4js")},566:e=>{e.exports=require("minimist")},245:e=>{e.exports=require("moment")},1:e=>{e.exports=require("cluster")},37:e=>{e.exports=require("os")}},t={};!function r(o){var a=t[o];if(void 0!==a)return a.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,r),i.exports}(728)})();