(()=>{"use strict";var e={8936:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(5473)),n=r(8944),s=r(9739),u=r(8275),c=r(5179),d=r(1616);t.default=class{constructor(){this.dao=new n.areasDAO,this.GerenciasDAO=new c.gerenciasDAO,this.SubgerenciasDAO=new d.subgerenciasDAO,this.CoordinacionesDAO=new s.coordinacionesDAO,this.DepartamentosDAO=new u.departamentosDAO}obtenerTodas(){return o(this,void 0,void 0,(function*(){try{return yield this.dao.obtenerTodos()}catch(e){a.default.error("Error en apiAreas-obtenerTodas: "+e)}}))}obtenerNombrePorId(e){return o(this,void 0,void 0,(function*(){try{return yield this.dao.obtenerNombrePorId(e)}catch(e){a.default.error("Error en apiAreas-obtenerNombrePorId: "+e)}}))}editarArea(e,t){return o(this,void 0,void 0,(function*(){return yield this.dao.actualizarDatos(e,t).then((e=>e)).catch((e=>{a.default.error("Error en editarArea: "+e)}))}))}obtenerGerencias(){return o(this,void 0,void 0,(function*(){return yield this.GerenciasDAO.getAll().then((e=>e)).catch((e=>{a.default.error("Error en obtenerGerencias: "+e)}))}))}obtenerSubgerencias(){return o(this,void 0,void 0,(function*(){return yield this.SubgerenciasDAO.getAll().then((e=>e)).catch((e=>{a.default.error("Error en obtenerSubgerencias: "+e)}))}))}obtenerCoordinaciones(){return o(this,void 0,void 0,(function*(){return yield this.CoordinacionesDAO.getAll().then((e=>e)).catch((e=>{a.default.error("Error en obtenerCoordinaciones: "+e)}))}))}obtenerDepartamentos(){return o(this,void 0,void 0,(function*(){return yield this.DepartamentosDAO.getAll().then((e=>e)).catch((e=>{a.default.error("Error en obtenerDepartamentos. "+e)}))}))}editarDescripcionArea(e){return o(this,void 0,void 0,(function*(){switch(e.areaTipo){case"gerencia":yield this.GerenciasDAO.editarDescripcion(e);break;case"subgerencia":yield this.SubgerenciasDAO.editarDescripcion(e);break;case"coordinacion":yield this.CoordinacionesDAO.editarDescripcion(e);break;case"departamento":yield this.DepartamentosDAO.editarDescripcion(e)}}))}}},3323:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=r(7297),a=r(1880),n=r(4418);t.default=class{constructor(){this.acciones=new i.accionesDAO,this.memoria=new n.memoriasDAO,this.accionesView=new a.accionesViewDAO}obtenerAcciones(){return o(this,void 0,void 0,(function*(){return yield this.accionesView.getAll()}))}crearAccion(e){return o(this,void 0,void 0,(function*(){yield this.acciones.crearAccion(e)}))}obtenerMemorias(){return o(this,void 0,void 0,(function*(){return yield this.memoria.getAll()}))}crearMemoria(e){return o(this,void 0,void 0,(function*(){yield this.memoria.crearMemoria(e)}))}guardarSintesis(e){return o(this,void 0,void 0,(function*(){yield this.memoria.guardarSintesis(e)}))}}},7575:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(5473)),n=r(3758);t.default=class{constructor(){this.pegiDAO=new n.pegiDAO}obtenerPegi(e){return o(this,void 0,void 0,(function*(){try{return e?yield this.pegiDAO.obtenerTodosPorArea(e):yield this.pegiDAO.obtenerTodos()}catch(e){a.default.error("Error en apiPegi-obtenerPegi: "+e)}}))}}},3119:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(1908)),n=i(r(1614)),s=r(927),u=i(r(5473)),c=i(r(3809)),d=r(5198);t.default=class{constructor(){this.tarjetasDAO=new a.default,this.tarjetasViewDAO=new n.default,this.tagsDAO=new s.tagsDAO,this.relacionesDAO=new c.default,this.usuariosDAO=new d.usuariosDAO}ordenarTarjetas(e){return e.sort(((e,t)=>{let r=new Date(e.tarjetasfecha);return new Date(t.tarjetasfecha)>r?1:-1})),e}obtenerTags(e){return o(this,void 0,void 0,(function*(){if(e){let t=[];for(const r of yield this.relacionesDAO.obtenerPorTarjeta(e))t.push(yield this.tagsDAO.obtenerNombrePorId(r.relaciontag));return t}}))}obtenerTarjetasAprobadas(){return o(this,void 0,void 0,(function*(){let e=this.ordenarTarjetas(yield this.tarjetasViewDAO.obtenerTarjetasAprobadas());for(const t of e)t.tarjetastags=yield this.obtenerTags(t.idtarjetas),t.tarjetasultmodusuario=yield this.usuariosDAO.obtenerNombrePorId(t.tarjetasultmodusuario);return e}))}obtenerTarjetasEvaluandose(){return o(this,void 0,void 0,(function*(){const e=this.ordenarTarjetas(yield this.tarjetasViewDAO.obtenerTarjetasEvaluandose());for(const t of e)t.tarjetastags=yield this.obtenerTags(t.idtarjetas),t.tarjetasultmodusuario=yield this.usuariosDAO.obtenerNombrePorId(t.tarjetasultmodusuario);return e}))}obtenerTarjetasRechazadas(){return o(this,void 0,void 0,(function*(){const e=this.ordenarTarjetas(yield this.tarjetasViewDAO.obtenerTarjetasRechazadas());for(const t of e)t.tarjetastags=yield this.obtenerTags(t.idtarjetas),t.tarjetasultmodusuario=yield this.usuariosDAO.obtenerNombrePorId(t.tarjetasultmodusuario);return e}))}agregarTarjeta(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.tarjetasDAO.agregarTarjeta(e).then((r=>o(this,void 0,void 0,(function*(){if("tarjeta agregada"==r){const r=yield this.tarjetasDAO.obtenerIdPorTitulo(e.tarjetastitulo);return yield this.relacionesDAO.agregarRelaciones(t,r),"tarjeta agregada"}}))))}catch(e){u.default.error("Error en apiTarjetas-agregarTarjeta: "+e)}}))}getTags(){return o(this,void 0,void 0,(function*(){try{return yield this.tagsDAO.obtenerTodos()}catch(e){u.default.error("Error en apiTarjetas-getTags: "+e)}}))}obtenerTagsOrdenados(){return o(this,void 0,void 0,(function*(){let e=[],t=yield this.getTags();for(const r of t)e.push(r.tagsnombre);return e.sort()}))}guardarCambiosYAprobar(e,t){return o(this,void 0,void 0,(function*(){try{return t.titulo&&t.cuerpo&&t.tags?(yield this.relacionesDAO.editarRelaciones(e,t.tags),yield this.tarjetasDAO.actualizarDatosYAprobar(e,t)):"campos incompletos"}catch(e){return"error"}}))}rechazarTarjeta(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.tarjetasDAO.rechazarTarjeta(e,t)}catch(e){return"error"}}))}aprobarTarjeta(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.tarjetasDAO.aprobarTarjeta(e,t)}catch(e){return"error"}}))}evaluarTarjeta(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.tarjetasDAO.evaluarTarjeta(e,t)}catch(e){return"error"}}))}}},4700:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(5095),n=r(5198),s=r(4551),u=i(r(5473));t.default=class{constructor(){this.usuariosDAO=new n.usuariosDAO,this.usuariosViewDAO=new s.usuariosViewDAO}comprobarAutorizacion(e,t){return o(this,void 0,void 0,(function*(){try{return(yield this.usuariosDAO.validarNombre(e))?(yield this.usuariosDAO.validarContrasenia(e,t))?"contrasenia correcta":"contrasenia incorrecta":"nombre incorrecto"}catch(e){u.default.error("Error en apiUsuarios-comprobarAutorizacion. "+e)}}))}obtenerIdPorNombre(e){return o(this,void 0,void 0,(function*(){return(yield this.usuariosDAO.obtenerPorNombre(e)).idusuarios}))}obtenerTipoPorNombre(e){return o(this,void 0,void 0,(function*(){try{return(yield this.usuariosDAO.obtenerPorNombre(e)).usuariostipo}catch(e){u.default.error("Error en apiUsuarios-obtenerTipoPorNombre: "+e)}}))}obtenerTodos(){return o(this,void 0,void 0,(function*(){try{return yield this.usuariosViewDAO.obtenerTodos()}catch(e){u.default.error("Error en apiUsuarios-obtenerTodos: "+e)}}))}altaUsuario(e){return o(this,void 0,void 0,(function*(){try{const{nombre:t,area:r}=e;if(t&&r){if(yield this.usuariosDAO.validarNombre(t))return"ya existe";let e,o=(0,a.createHash)("temporal319");switch(r){case 6:e=2;break;case 8:e=1;break;case 18:e=1;case 17:e=4;break;case 19:e=5;break;default:e=3}const i={idusuarios:null,usuariosnombre:t,usuarioscontrasenia:o,usuariosarea:r,usuariostipo:e};return"error"==(yield this.usuariosDAO.agregarUsuario(i))?"error":"ok"}return"error"}catch(e){return u.default.error("Error en apiUsuarios-altaUsuario: "+e),"error"}}))}obtenerAreaPorNombre(e){return o(this,void 0,void 0,(function*(){return(yield this.usuariosDAO.obtenerPorNombre(e)).usuariosarea}))}actualizarPass(e,t){return o(this,void 0,void 0,(function*(){return yield this.usuariosDAO.actualizarPass(e,(0,a.createHash)(t)).then((e=>e)).catch((e=>{u.default.error("Error en apiUsuarios-actualizarPass: "+e)}))}))}}},6752:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;const i=o(r(6860)),a=r(327),n=o(r(2245)),s=o(r(4274));t.App=class{constructor(e){this.app=(0,i.default)(),this.routes=new s.default,this.router=[{path:"/",name:this.routes.home()},{path:"/auth",name:this.routes.auth()},{path:"/tse",name:this.routes.tse()},{path:"/api",name:this.routes.api()},{path:"/admin",name:this.routes.admin()},{path:"/memoria",name:this.routes.memoria()}],this.puerto=e}startMiddleware(){a.middlewareGlobal.forEach((e=>{this.app.use(e)}))}startRouter(){this.router.forEach((e=>{this.app.use(e.path,e.name)}))}setTemplateEngine(){this.app.set("view engine","ejs"),this.app.set("views","./src/views"),this.app.locals.moment=n.default}setPuerto(){this.app.set("port",this.puerto)}iniciarAplicacion(){return this.setPuerto(),this.startMiddleware(),this.setTemplateEngine(),this.startRouter(),this.app}}},4226:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(7575)),n=i(r(3119)),s=i(r(4700)),u=i(r(8936)),c=i(r(5473));t.default=class{constructor(){this.apiPegi=new a.default,this.apiTarjetas=new n.default,this.apiUsuarios=new s.default,this.apiAreas=new u.default}getGGAdministracion(e,t){return o(this,void 0,void 0,(function*(){try{const r=yield this.apiUsuarios.obtenerTodos(),o=yield this.apiAreas.obtenerTodas(),i=yield this.apiTarjetas.obtenerTarjetasEvaluandose(),a=yield this.apiTarjetas.obtenerTarjetasAprobadas(),n=yield this.apiTarjetas.obtenerTarjetasRechazadas(),s=yield this.apiTarjetas.obtenerTagsOrdenados();return t.render("../views/pages/administracion.ejs",{usuarioLogueado:e.session.usuarioLogueado,usuario:e.session.usuario,usuarios:r,areas:o,tags:s.sort(),tipo:e.session.tipo,tarjetas:i,tarjetasAprobadas:a,tarjetasRechazadas:n,error:!1})}catch(e){return c.default.error("Error en getGGAdministracion: "+e),t.json({result:"error en el servidor"})}}))}postAlta(e,t){return o(this,void 0,void 0,(function*(){try{const r=e.body;let o=yield this.apiUsuarios.altaUsuario(r);if("ok"==o)return t.status(200).redirect("/admin");if("ya existe"==o)return t.status(201).json({result:"ya existe el usuario"})}catch(e){return c.default.error("Error en postAlta: "+e),t.json({result:"error en el servidor"})}}))}}},847:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(8936)),n=i(r(5473));t.default=class{constructor(){this.apiAreas=new a.default}getAreas(e,t){return o(this,void 0,void 0,(function*(){try{const e=yield this.apiAreas.obtenerTodas();t.json(e)}catch(e){return n.default.error("Error en getAreas: ",e),t.json({result:"error en el servidor"})}}))}editarArea(e,t){return o(this,void 0,void 0,(function*(){try{let r=e.params.id,o=e.body;if(o.nombre&&o.iniciales)return yield this.apiAreas.editarArea(r,o).then((e=>{if("ok"==e)return t.status(200).redirect("/admin")}))}catch(e){return n.default.error("error en editarArea: "+e),t.json({result:"error en el servidor"})}}))}}},9014:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(8936)),n=i(r(4700)),s=i(r(5473));t.default=class{constructor(){this.api=new n.default,this.apiAreas=new a.default}getLogin(e,t){return o(this,void 0,void 0,(function*(){try{return t.render("../views/pages/login.ejs",{usuarioLogueado:!1,error:!1,tipo:null})}catch(e){return s.default.error("Error en getLogin: "+e),t.json({result:"error en el servidor"})}}))}postLogin(e,t){return o(this,void 0,void 0,(function*(){try{const{nombre:r,contrasenia:o}=e.body;if(!r||!o)return t.render("../views/pages/login",{usuarioLogueado:e.session.usuarioLogueado||!1,usuario:e.session.usuario||null,error:"Debe completar todos los campos."});switch(yield this.api.comprobarAutorizacion(r,o)){case"nombre incorrecto":return t.render("../views/pages/login",{usuarioLogueado:e.session.usuarioLogueado||!1,usuario:e.session.usuario||null,error:"Nombre de usuario incorrecto"});case"contrasenia incorrecta":return t.render("../views/pages/login",{usuarioLogueado:e.session.usuarioLogueado||!1,usuario:e.session.usuario||null,error:"Contraseña incorrecta"});case"contrasenia correcta":return e.session.usuario=r,e.session.tipo=yield this.api.obtenerTipoPorNombre(r),e.session.area=yield this.api.obtenerAreaPorNombre(r),e.session.usuarioLogueado=!0,e.session.save(),t.redirect("/tse")}}catch(e){return s.default.error("Error en postLogin: "+e),t.json({result:"error en el servidor"})}}))}getLogout(e,t){return o(this,void 0,void 0,(function*(){try{return e.session.destroy((e=>{e&&t.send({status:"Logout Error",body:e})})),t.redirect("/")}catch(e){return s.default.error("Error en getLogout: "+e),t.json({result:"error en el servidor"})}}))}getSessionData(e,t){return o(this,void 0,void 0,(function*(){try{return t.json({area:e.session.area})}catch(e){return s.default.error("Error en getSessionData: "+e),t.json({result:"error en el servidor"})}}))}postNewPass(e,t){return o(this,void 0,void 0,(function*(){try{const{pass:r,newPass:o,newPass2:i}=e.body,{usuario:a}=e.session;if(r&&o&&i&&a&&o==i){const e=yield this.api.comprobarAutorizacion(a,r);if("contrasenia correcta"==e)return yield this.api.actualizarPass(a,o).then((e=>{if("ok"==e)return t.status(200).redirect("/tse")}));if("contrasenia incorrecta"==e)return t.status(201).json({result:"contrasenia incorrecta"})}}catch(e){return s.default.error("Error en postNewPass: "+e),t.json({result:"error en el servidor"})}}))}}},8856:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(5473));t.default=class{getHome(e,t){return o(this,void 0,void 0,(function*(){try{return t.render("../views/pages/home",{usuarioLogueado:e.session.usuarioLogueado,usuario:e.session.usuario,tipo:e.session.tipo})}catch(e){return a.default.error("Error en getHome: "+e),t.json({result:"error en el servidor"})}}))}}},2331:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(8936)),n=i(r(3119)),s=i(r(3323));t.default=class{constructor(){this.apiAreas=new a.default,this.apiTarjetas=new n.default,this.apiMemorias=new s.default}getFormulario(e,t){return o(this,void 0,void 0,(function*(){return t.render("../views/pages/memoria/formulario.ejs")}))}getAcciones(e,t){return o(this,void 0,void 0,(function*(){let e=yield this.apiMemorias.obtenerAcciones();return t.status(200).json(e)}))}getGerencias(e,t){return o(this,void 0,void 0,(function*(){let e=yield this.apiAreas.obtenerGerencias();return t.status(200).json(e)}))}getSubgerencias(e,t){return o(this,void 0,void 0,(function*(){let e=yield this.apiAreas.obtenerSubgerencias();return t.status(200).json(e)}))}getCoordinaciones(e,t){return o(this,void 0,void 0,(function*(){let e=yield this.apiAreas.obtenerCoordinaciones();return t.status(200).json(e)}))}getDepartamentos(e,t){return o(this,void 0,void 0,(function*(){let e=yield this.apiAreas.obtenerDepartamentos();return t.status(200).json(e)}))}getTags(e,t){return o(this,void 0,void 0,(function*(){let e=yield this.apiTarjetas.getTags();return t.status(200).json(e)}))}getMemorias(e,t){return o(this,void 0,void 0,(function*(){let e=yield this.apiMemorias.obtenerMemorias();return t.status(200).json(e)}))}postMemorias(e,t){return o(this,void 0,void 0,(function*(){let r=e.body;try{yield this.apiMemorias.crearMemoria(r),t.status(200).json({success:!0})}catch(e){t.status(204).json({error:"no se pudo crear memoria"})}}))}putArea(e,t){return o(this,void 0,void 0,(function*(){let r=e.body;try{yield this.apiAreas.editarDescripcionArea(r),t.status(200).json({success:!0})}catch(e){t.status(204).json({error:"no se pudo editar la descripcion"})}}))}postAcciones(e,t){return o(this,void 0,void 0,(function*(){let r=e.body;try{yield this.apiMemorias.crearAccion(r),t.status(200).json({success:!0})}catch(e){t.status(204).json({error:"no se pudo crear accion"})}}))}putMemoria(e,t){return o(this,void 0,void 0,(function*(){try{let r=e.body;yield this.apiMemorias.guardarSintesis(r),t.status(200).json({success:!0})}catch(e){t.status(204).json({success:!1})}}))}}},7312:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(7575)),n=i(r(5473));t.default=class{constructor(){this.api=new a.default}getPegi(e,t){return o(this,void 0,void 0,(function*(){try{let e=yield this.api.obtenerPegi(),r=this.convertirData(e);return r={ejes:this.quitarDuplicados(r.ejes,"idejes"),objetivos:this.quitarDuplicados(r.objetivos,"idobjetivos"),lineas:this.quitarDuplicados(r.lineas,"idlineas"),planesDeAccion:this.quitarDuplicados(r.planesDeAccion,"idplanesdeaccion")},t.json(r)}catch(e){return n.default.error("Error en getPegi: "+e),t.json({result:"error en el servidor"})}}))}convertirData(e){try{let t=[],r=[],o=[],i=[];for(const a of e)t.push({idejes:a.idejes,ejesnombre:a.ejesnombre}),r.push({idobjetivos:a.idobjetivos,objetivosnombre:a.objetivosnombre,objetivoseje:a.objetivoseje}),o.push({idlineas:a.idlineas,lineasnombre:a.lineasnombre,lineasobjetivo:a.lineasobjetivo}),i.push({idplanesdeaccion:a.idplanesdeaccion,planesdeaccionnombre:a.planesdeaccionnombre,planesdeaccionlinea:a.planesdeaccionlinea,planesdeaccionarea:a.planesdeaccionarea,areasnombre:a.areasnombre,areasdescripcion:a.areasdescripcion});return{ejes:t,objetivos:r,lineas:o,planesDeAccion:i}}catch(e){return n.default.error("Error en convertirData: "+e),{ejes:[],objetivos:[],lineas:[],planesDeAccion:[]}}}quitarDuplicados(e,t){try{if(e){let r=[];r.push(e[0]);for(let o of e)void 0===r.find((e=>e[t]===o[t]))&&r.push(o);return r}}catch(e){n.default.error("Error en quitarDuplicados: "+e)}}getPegiFiltrado(e,t){return o(this,void 0,void 0,(function*(){try{let r=e.session.area,o=yield this.api.obtenerPegi(r),i=this.convertirData(o);return i={ejes:this.quitarDuplicados(i.ejes,"idejes"),objetivos:this.quitarDuplicados(i.objetivos,"idobjetivos"),lineas:this.quitarDuplicados(i.lineas,"idlineas"),planesDeAccion:this.quitarDuplicados(i.planesDeAccion,"idplanesdeaccion")},t.json(i)}catch(e){return n.default.error("Error en getPegiFiltrado: "+e),t.json({result:"error en el servidor"})}}))}descargarPegi(e,t){return o(this,void 0,void 0,(function*(){try{const e=`${__dirname}/public/files/IF-2022-62930192-APN-GG%INCAA.pdf`;t.download(e)}catch(e){n.default.error("Error en descargarPegi: "+e)}}))}descargarNorma(e,t){return o(this,void 0,void 0,(function*(){try{const e=`${__dirname}/public/files/RS-2022-71880387-APN-INCAA%MC.pdf`;t.download(e)}catch(e){n.default.error("Error en descargarNorma: "+e)}}))}}},9022:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(8936)),n=i(r(3119)),s=i(r(4700)),u=i(r(5473));t.default=class{constructor(){this.apiTarjetas=new n.default,this.apiUsuarios=new s.default,this.apiAreas=new a.default}getTarjetasAprobadas(e,t){return o(this,void 0,void 0,(function*(){try{const e=yield this.apiTarjetas.obtenerTarjetasAprobadas();return t.json(e)}catch(e){return u.default.error("Error en getTarjetasAprobadas: "+e),t.status(202).json({result:"error en el servidor"})}}))}postNuevaTarjeta(e,t){return o(this,void 0,void 0,(function*(){const{eje:r,objetivo:o,linea:i,plandeaccion:a,titulo:n,cuerpo:s,expediente:c,actoadministrativo:d,tags:l}=e.body,h=e.session.usuario;if(r&&o&&i&&a&&n&&s&&l&&h){const e=yield this.apiUsuarios.obtenerAreaPorNombre(h),f=yield this.apiUsuarios.obtenerIdPorNombre(h);if(f){const h={idtarjetas:void 0,tarjetastitulo:n,tarjetascuerpo:s,tarjetasautor:f,tarjetasareas:e,tarjetasexpediente:c,tarjetasactoadministrativo:d,tarjetasejes:r,tarjetasobjetivos:o,tarjetaslineas:i,tarjetasplandeaccion:a,tarjetasestado:2,tarjetasfecha:new Date,tarjetasultmodusuario:f};return yield this.apiTarjetas.agregarTarjeta(h,l).then((e=>{if("tarjeta agregada"==e)return t.status(200).redirect("/tse")})).catch((e=>(u.default.error("Error en postNuevaTarjeta: "+e),t.status(202).json({result:"error en el servidor"}))))}}}))}guardarCambiosYAprobar(e,t){return o(this,void 0,void 0,(function*(){let r=parseInt(e.params.id),o=e.body,i=e.session.usuario;if(o.titulo&&o.cuerpo&&o.tags&&i){let e=yield this.apiUsuarios.obtenerIdPorNombre(i);return o.usuario=e,yield this.apiTarjetas.guardarCambiosYAprobar(r,o).then((e=>{if("ok"==e)return t.status(200).redirect("/admin")})).catch((e=>(u.default.error("Error en guardarCambiosYAprobar: "+e),t.status(202).json({result:"error en el servidor"}))))}}))}rechazarTarjeta(e,t){return o(this,void 0,void 0,(function*(){let r=parseInt(e.params.id),o=e.session.usuario;if(o){let e=yield this.apiUsuarios.obtenerIdPorNombre(o);return yield this.apiTarjetas.rechazarTarjeta(r,e).then((e=>{if("ok"==e)return t.status(200).redirect("/admin")})).catch((e=>(u.default.error("Error en rechazarTarjeta: "+e),t.status(202).json({result:"error en el servidor"}))))}}))}aprobarTarjeta(e,t){return o(this,void 0,void 0,(function*(){let r=parseInt(e.params.id),o=e.session.usuario;if(o){let e=yield this.apiUsuarios.obtenerIdPorNombre(o);return yield this.apiTarjetas.aprobarTarjeta(r,e).then((e=>{if("ok"==e)return t.status(200).redirect("/admin")})).catch((e=>(u.default.error("Error en aprobarTarjeta: "+e),t.status(202).json({result:"error en el servidor"}))))}}))}evaluarTarjeta(e,t){return o(this,void 0,void 0,(function*(){let r=e.session.usuario,o=parseInt(e.params.id);if(r){let e=yield this.apiUsuarios.obtenerIdPorNombre(r);return yield this.apiTarjetas.evaluarTarjeta(o,e).then((e=>{if("ok"==e)return t.status(200).redirect("/admin")})).catch((e=>(u.default.error("Error en evaluarTarjeta: "+e),t.status(202).json({result:"error en el servidor"}))))}}))}}},9696:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(3119)),n=i(r(5473)),s=i(r(8936));t.default=class{constructor(){this.apiTarjetas=new a.default,this.apiAreas=new s.default}getTse(e,t){return o(this,void 0,void 0,(function*(){try{const r=yield this.apiTarjetas.obtenerTagsOrdenados(),o=yield this.apiAreas.obtenerTodas();return t.render("../views/pages/tse.ejs",{usuarioLogueado:e.session.usuarioLogueado,usuario:e.session.usuario,tipo:e.session.tipo,areas:o,tags:r,error:!1})}catch(e){return n.default.error("Error en getTse: "+e),t.json({result:"Error en el servidor"})}}))}getNewPass(e,t){return o(this,void 0,void 0,(function*(){try{return t.render("../views/pages/contrasenia",{usuarioLogueado:e.session.usuarioLogueado,usuario:e.session.usuario,tipo:e.session.tipo,error:!1})}catch(e){return n.default.error("Error en getNewPass: "+e),t.json({result:"Error en el servidor"})}}))}}},7397:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ENV=void 0,o(r(5142)).default.config(),t.ENV={NODE_ENV:"production",PORT:process.env.PORT||"8080",DB_PORT:process.env.DB_PORT,DB_HOST:process.env.DB_HOST,DB_USER:process.env.DB_USER,DB_PASS:process.env.DB_PASS,DB_NAME:process.env.DB_NAME,SECRET:process.env.SESSION_SECRET,KEY:process.env.SESSION_KEY}},5473:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(r(8094)),a=r(7397);i.default.configure({appenders:{logConsola:{type:"console"},logArchivo:{type:"file",filename:"./log/logs.log"}},categories:{default:{appenders:["logConsola"],level:"info"},consola:{appenders:["logConsola"],level:"info"},archivo:{appenders:["logArchivo"],level:"warn"}}});let n=i.default.getLogger("consola");n.level="info";let s,u=i.default.getLogger("archivo");switch(u.level="warn",a.ENV.NODE_ENV){case"desarrollo":default:s=n;break;case"produccion":s=u}t.default=s},6409:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.midGG=t.midGeneral=void 0,t.midGeneral=function(e,t,r){if(!e.session.usuarioLogueado)return t.redirect("/auth/login");r()},t.midGG=function(e,t,r){if(2!=e.session.tipo)return t.redirect("/");r()}},327:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.middlewareGlobal=void 0;const s=n(r(6508)),u=n(r(3986)),c=n(r(3582)),d=n(r(7455)),l=r(7397),h=a(r(6508)),f=n(r(6860)),p=n(r(8283)),v=n(r(7806)),b=n(r(5473)),y=n(r(9710)),m=new((0,p.default)(h))({host:l.ENV.DB_HOST,port:l.ENV.DB_PORT,user:l.ENV.DB_USER,password:l.ENV.DB_PASS,database:l.ENV.DB_NAME});let g;g={key:l.ENV.KEY,secret:l.ENV.SECRET,store:m,resave:!1,saveUninitialized:!1},t.middlewareGlobal=[f.default.static(__dirname+"/public"),u.default.json(),u.default.urlencoded({extended:!0}),(0,y.default)(),(0,c.default)(),(0,v.default)({contentSecurityPolicy:!1}),(0,d.default)(),(0,s.default)(g),(e,t,r,o)=>function(e,t,r,o){if(e)return b.default.error(e),r.status(e.statusCode||500).json(e.message);o()}(e,0,r,o)]},7297:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.accionesDAO=void 0;const a=i(r(5473)),n=i(r(7120));class s extends n.default{constructor(){super("acciones")}crearAccion(e){return o(this,void 0,void 0,(function*(){return yield this.knex(this.tabla).insert({accionmemoria:e.memoria,acciondescripcion:e.descripcion,accioneje:e.eje,accionresultados:e.resultados,accionresumen:e.resumen,acciontipo:e.tipo,acciontitulo:e.titulo,acciontags:e.tags.join(";")}).catch((e=>a.default.error(e)))}))}}t.accionesDAO=s},1880:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.accionesViewDAO=void 0;const i=o(r(7120));class a extends i.default{constructor(){super("acciones_view")}}t.accionesViewDAO=a},8944:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.areasDAO=void 0;const a=i(r(5473)),n=i(r(7120));class s extends n.default{constructor(){super("areas")}obtenerTodos(){return o(this,void 0,void 0,(function*(){try{return yield this.getAll()}catch(e){a.default.error("Error en areasDAO-obtenerTodos. "+e)}}))}obtenerNombrePorId(e){return o(this,void 0,void 0,(function*(){try{let t;return yield this.knex(this.tabla).where({idareas:e}).then((e=>{e&&(t=e.areasnombre)})),t}catch(e){a.default.error("Error en areasDAO-obtenerNombrePorId: "+e)}}))}actualizarDatos(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.knex(this.tabla).where({idareas:e}).update({areasnombre:t.iniciales,areasdescripcion:t.nombre}),"ok"}catch(e){return a.default.error("Error en areasDAO-actualizarDatos: "+e),"error"}}))}}t.areasDAO=s},9739:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.coordinacionesDAO=void 0;const a=i(r(5473)),n=i(r(7120));class s extends n.default{constructor(){super("coordinaciones")}editarDescripcion(e){return o(this,void 0,void 0,(function*(){yield this.knex(this.tabla).where({coordinacionnombre:e.areaNombre}).update({coordinaciondescripcion:e.areaDescripcion}).catch((e=>a.default.error(e)))}))}}t.coordinacionesDAO=s},8275:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.departamentosDAO=void 0;const a=i(r(5473)),n=i(r(7120));class s extends n.default{constructor(){super("departamentos")}editarDescripcion(e){return o(this,void 0,void 0,(function*(){yield this.knex(this.tabla).where({departamentonombre:e.areaNombre}).update({departamentodescripcion:e.areaDescripcion}).catch((e=>a.default.error(e)))}))}}t.departamentosDAO=s},5179:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.gerenciasDAO=void 0;const a=i(r(5473)),n=i(r(7120));class s extends n.default{constructor(){super("gerencias")}editarDescripcion(e){return o(this,void 0,void 0,(function*(){yield this.knex(this.tabla).where({gerencianombre:e.areaNombre}).update({gerenciadescripcion:e.areaDescripcion}).catch((e=>a.default.error(e)))}))}}t.gerenciasDAO=s},4418:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.memoriasDAO=void 0;const a=i(r(5473)),n=i(r(7120));class s extends n.default{constructor(){super("memorias")}crearMemoria(e){return o(this,void 0,void 0,(function*(){return yield this.knex(this.tabla).insert({anio:e.anio,area:e.areaNombre,areatipo:e.areaTipo}).catch((e=>a.default.error("Error en crearMemoria: "+e)))}))}guardarSintesis(e){return o(this,void 0,void 0,(function*(){yield this.knex(this.tabla).where({id:e.id}).update({sintesis:e.sintesis}).catch((e=>{a.default.error("error en guardarSintesis. "+e)}))}))}}t.memoriasDAO=s},3758:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.pegiDAO=void 0;const a=i(r(5473)),n=i(r(7120));class s extends n.default{constructor(){super("pegi")}obtenerTodosPorArea(e){return o(this,void 0,void 0,(function*(){try{return(yield this.getAll()).filter((t=>t.idareas==e))}catch(e){a.default.error("Error en pegiDAO-obtenerTodosPorArea: "+e)}}))}obtenerTodos(){return o(this,void 0,void 0,(function*(){try{return yield this.getAll()}catch(e){a.default.error("Error en pegiDAO-obtenerTodos: "+e)}}))}}t.pegiDAO=s},3809:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(5473)),n=i(r(7120)),s=r(927);class u extends n.default{constructor(){super("relaciones"),this.tagsDAO=new s.tagsDAO}agregarRelaciones(e,t){return o(this,void 0,void 0,(function*(){try{for(const r of e){const e=yield this.tagsDAO.obtenerIdPorNombre(r);this.save({idrelacion:null,relaciontarjeta:t,relaciontag:e})}}catch(e){a.default.error("Error en relacionesDAO - agregarRelacion: "+e)}}))}editarRelaciones(e,t){return o(this,void 0,void 0,(function*(){this.knex(this.tabla).where({relaciontarjeta:e}).del().then((()=>o(this,void 0,void 0,(function*(){for(const r of t){const t=yield this.tagsDAO.obtenerIdPorNombre(r);this.save({idrelacion:null,relaciontag:t,relaciontarjeta:e})}})))).catch((e=>{a.default.error("Error en relacionesDAO- editarRelaciones: "+e)}))}))}obtenerPorTarjeta(e){return o(this,void 0,void 0,(function*(){try{return this.knex(this.tabla).where({relaciontarjeta:e})}catch(e){a.default.error("Error en relacionesDAO- obtenerPorTarjeta: "+e)}}))}}t.default=u},1616:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.subgerenciasDAO=void 0;const a=i(r(5473)),n=i(r(7120));class s extends n.default{constructor(){super("subgerencias")}obtenerTodos(){return o(this,void 0,void 0,(function*(){try{return yield this.getAll()}catch(e){a.default.error("Error en subgerenciasDAO-obtenerTodos. "+e)}}))}editarDescripcion(e){return o(this,void 0,void 0,(function*(){yield this.knex(this.tabla).where({subgerencianombre:e.areaNombre}).update({subgerenciadescripcion:e.areaDescripcion}).catch((e=>a.default.error(e)))}))}}t.subgerenciasDAO=s},927:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.tagsDAO=void 0;const a=i(r(5473)),n=i(r(7120));class s extends n.default{constructor(){super("tags")}obtenerTodos(){return o(this,void 0,void 0,(function*(){try{return yield this.getAll()}catch(e){a.default.error("Error en tagsDAO-obtenerTodos: "+e)}}))}obtenerIdPorNombre(e){return o(this,void 0,void 0,(function*(){try{return this.knex(this.tabla).where({tagsnombre:e}).first().then((e=>e.idtags))}catch(e){a.default.error("Error en tagsDAO-obtenerIdPorNombre: "+e)}}))}obtenerNombrePorId(e){return o(this,void 0,void 0,(function*(){try{return this.knex(this.tabla).where({idTags:e}).first().then((e=>e.tagsnombre))}catch(e){a.default.error("Error en tagsDAO-obtenerNombrePorId: "+e)}}))}}t.tagsDAO=s},1908:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(7120)),n=i(r(5473));class s extends a.default{constructor(){super("tarjetas")}agregarTarjeta(e){return o(this,void 0,void 0,(function*(){try{return yield this.save(e),"tarjeta agregada"}catch(e){n.default.error("Error en tarjetasDAO-agregarTarjeta: "+e)}}))}actualizarDatosYAprobar(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.knex(this.tabla).where({idtarjetas:e}).update({tarjetastitulo:t.titulo,tarjetascuerpo:t.cuerpo,tarjetasexpediente:t.expediente,tarjetasactoadministrativo:t.actoadministrativo,tarjetasestado:1,tarjetasultmodusuario:t.usuario}),"ok"}catch(e){return n.default.error("Error en tarjetasDAO-actualizarDatosYAprobar: "+e),"error"}}))}aprobarTarjeta(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.knex(this.tabla).where({idtarjetas:e}).update({tarjetasestado:1,tarjetasultmodusuario:t}),"ok"}catch(e){return n.default.error("Error en tarjetasDAO-aprobarTarjeta: "+e),"error"}}))}rechazarTarjeta(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.knex(this.tabla).where({idtarjetas:e}).update({tarjetasestado:0,tarjetasultmodusuario:t}),"ok"}catch(e){return n.default.error("Error en tarjetasDAO-rechazarTarjeta: "+e),"error"}}))}evaluarTarjeta(e,t){return o(this,void 0,void 0,(function*(){try{return yield this.knex(this.tabla).where({idtarjetas:e}).update({tarjetasestado:2,tarjetasultmodusuario:t}),"ok"}catch(e){return n.default.error("Error en tarjetasDAO-evaluarTarjeta: "+e),"error"}}))}obtenerIdPorTitulo(e){return o(this,void 0,void 0,(function*(){return yield this.knex(this.tabla).where({tarjetastitulo:e}).first().then((e=>e.idtarjetas))}))}}t.default=s},1614:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(r(7120)),n=i(r(5473));class s extends a.default{constructor(){super("tarjetas_view")}obtenerTarjetas(){return o(this,void 0,void 0,(function*(){try{return yield this.getAll()}catch(e){n.default.error("Error en tarjetasViewDAO-obtenerTarjetas: "+e)}}))}obtenerTarjetasAprobadas(){return o(this,void 0,void 0,(function*(){try{return(yield this.getAll()).filter((e=>1==e.tarjetasestado))}catch(e){n.default.error("Error en tarjetasViewDAO-obtenerTarjetasAprobadas: "+e)}}))}obtenerTarjetasEvaluandose(){return o(this,void 0,void 0,(function*(){try{return(yield this.getAll()).filter((e=>2==e.tarjetasestado))}catch(e){n.default.error("Error en tarjetasViewDAO-obtenerTarjetasEvaluandose: "+e)}}))}obtenerTarjetasRechazadas(){return o(this,void 0,void 0,(function*(){try{return(yield this.getAll()).filter((e=>0==e.tarjetasestado))}catch(e){n.default.error("Error en tarjetasViewDAO-obtenerTarjetasRechazadas: "+e)}}))}}t.default=s},5198:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.usuariosDAO=void 0;const a=i(r(7120)),n=r(85),s=i(r(5473));class u extends a.default{constructor(){super("usuarios")}obtenerPorNombre(e){return o(this,void 0,void 0,(function*(){try{let t;return yield this.knex(this.tabla).where({usuariosnombre:e}).first().then((e=>(t=e||void 0,t)))}catch(e){s.default.error("Error en usuariosDAO-obtenerPorNombre: "+e)}}))}obtenerPorId(e){return o(this,void 0,void 0,(function*(){try{let t;return yield this.knex(this.tabla).where({idusuarios:e}).first().then((e=>(t=e||null,t)))}catch(e){s.default.error("Error en usuariosDAO-obtenerPorId: "+e)}}))}obtenerNombrePorId(e){return o(this,void 0,void 0,(function*(){return yield this.obtenerPorId(e).then((e=>e.usuariosnombre))}))}validarNombre(e){return o(this,void 0,void 0,(function*(){try{return yield this.knex(this.tabla).where({usuariosnombre:e}).first().then((e=>!!e))}catch(e){s.default.error("Error en usuariosDAO-validarNombre: "+e)}}))}validarContrasenia(e,t){return o(this,void 0,void 0,(function*(){try{const r=yield this.obtenerPorNombre(e);return!!(0,n.contraseniaValida)(r,t)}catch(e){s.default.error("Error en usuariosDAO-validarContrasenia: "+e)}}))}agregarUsuario(e){return o(this,void 0,void 0,(function*(){try{return yield this.save(e),"usuario agregado"}catch(e){return s.default.error("Error en usuariosDAO-agregarUsuario: "+e),"error"}}))}obtenerTodos(){return o(this,void 0,void 0,(function*(){try{return yield this.getAll()}catch(e){s.default.error("Error en usuariosDAO-obtenerTodos: "+e)}}))}actualizarPass(e,t){return o(this,void 0,void 0,(function*(){return yield this.knex(this.tabla).where({usuariosnombre:e}).first().update({usuarioscontrasenia:t}).then((e=>e?"ok":"no se encontro usuario")).catch((e=>(s.default.error("Error en usuariosDAO-actualizarPass: "+e),"error")))}))}}t.usuariosDAO=u},4551:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.usuariosViewDAO=void 0;const a=i(r(7120));class n extends a.default{constructor(){super("usuarios_view")}obtenerTodos(){return o(this,void 0,void 0,(function*(){return yield this.getAll()}))}}t.usuariosViewDAO=n},7120:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(i,a){function n(e){try{u(o.next(e))}catch(e){a(e)}}function s(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(7397),n=i(r(5473)),s=i(r(514));let u;try{u=(0,s.default)({client:"mysql",connection:{host:a.ENV.DB_HOST,port:a.ENV.DB_PORT,user:a.ENV.DB_USER,password:a.ENV.DB_PASS,database:a.ENV.DB_NAME}}),n.default.info("PID Worker "+process.pid+". Base de datos conectada.")}catch(e){n.default.error(`Error en la conexión a la base de datos: ${e}`)}t.default=class{constructor(e){this.knex=u,this.tabla=e}save(e){return o(this,void 0,void 0,(function*(){yield this.knex(this.tabla).insert(e).catch((e=>n.default.error("Error en save: "+e)))}))}getAll(){return o(this,void 0,void 0,(function*(){return yield this.knex(this.tabla).select("*").then((e=>e)).catch((e=>{n.default.error("Error en getAll: "+e)}))}))}}},4274:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(r(8856)),a=o(r(9014)),n=o(r(9696)),s=r(6860),u=o(r(7312)),c=o(r(9022)),d=r(6409),l=o(r(4226)),h=o(r(847)),f=o(r(2331));t.default=class{constructor(){this.authController=new a.default,this.tseController=new n.default,this.pegiController=new u.default,this.tarjetasController=new c.default,this.adminController=new l.default,this.homeController=new i.default,this.areasController=new h.default,this.memoriaController=new f.default}home(){const e=(0,s.Router)();return e.get("/",((e,t)=>{this.homeController.getHome(e,t)})),e}memoria(){const e=(0,s.Router)();return e.get("/",((e,t)=>{this.memoriaController.getFormulario(e,t)})),e}auth(){const e=(0,s.Router)();return e.get("/login",((e,t)=>{this.authController.getLogin(e,t)})),e.post("/login",((e,t)=>{this.authController.postLogin(e,t)})),e.post("/newpass",((e,t)=>{this.authController.postNewPass(e,t)})),e.get("/logout",((e,t)=>{this.authController.getLogout(e,t)})),e}tse(){const e=(0,s.Router)();return e.use(d.midGeneral),e.get("/",((e,t)=>{this.tseController.getTse(e,t)})),e.get("/descargarpegi",((e,t)=>{this.pegiController.descargarPegi(e,t)})),e.get("/descargarnorma",((e,t)=>{this.pegiController.descargarNorma(e,t)})),e.post("/nuevo",((e,t)=>{this.tarjetasController.postNuevaTarjeta(e,t)})),e.get("/newpass",((e,t)=>{this.tseController.getNewPass(e,t)})),e}admin(){const e=(0,s.Router)();return e.use(d.midGG),e.get("/",((e,t)=>{this.adminController.getGGAdministracion(e,t)})),e.post("/alta",((e,t)=>{this.adminController.postAlta(e,t)})),e.post("/hito/guardaryaprobar/:id",((e,t)=>{this.tarjetasController.guardarCambiosYAprobar(e,t)})),e.post("/hito/rechazar/:id",((e,t)=>{this.tarjetasController.rechazarTarjeta(e,t)})),e.post("/hito/aprobar/:id",((e,t)=>{this.tarjetasController.aprobarTarjeta(e,t)})),e.post("/hito/evaluar/:id",((e,t)=>{this.tarjetasController.evaluarTarjeta(e,t)})),e.post("/areas/:id",((e,t)=>{this.areasController.editarArea(e,t)})),e}api(){const e=(0,s.Router)();return e.get("/pegi",((e,t)=>{this.pegiController.getPegi(e,t)})),e.get("/pegi2",d.midGeneral,((e,t)=>{this.pegiController.getPegiFiltrado(e,t)})),e.get("/tarjetas",d.midGeneral,((e,t)=>{this.tarjetasController.getTarjetasAprobadas(e,t)})),e.get("/sessiondata",d.midGeneral,((e,t)=>{this.authController.getSessionData(e,t)})),e.get("/gerencias",((e,t)=>this.memoriaController.getGerencias(e,t))),e.get("/subgerencias",((e,t)=>this.memoriaController.getSubgerencias(e,t))),e.get("/coordinaciones",((e,t)=>this.memoriaController.getCoordinaciones(e,t))),e.get("/departamentos",((e,t)=>this.memoriaController.getDepartamentos(e,t))),e.get("/tags",((e,t)=>this.memoriaController.getTags(e,t))),e.get("/memorias",((e,t)=>this.memoriaController.getMemorias(e,t))),e.post("/memorias",((e,t)=>this.memoriaController.postMemorias(e,t))),e.put("/memorias",((e,t)=>this.memoriaController.putMemoria(e,t))),e.get("/areas",((e,t)=>this.areasController.getAreas(e,t))),e.put("/areas",((e,t)=>this.memoriaController.putArea(e,t))),e.get("/acciones",((e,t)=>this.memoriaController.getAcciones(e,t))),e.post("/acciones",((e,t)=>this.memoriaController.postAcciones(e,t))),e}}},7728:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(6752),a=o(r(1566)),n=o(r(2037)),s=r(7397),u=o(r(3685)),c=o(r(5473)),d=o(r(5001)),l=o(r(6974)),h={alias:{p:"puerto"},default:{puerto:s.ENV.PORT}},f=function(e){let t=parseInt(e,10);return isNaN(t)?e:t>=0?t:""}((0,a.default)(process.argv.slice(2),h).p),p=new i.App(f).iniciarAplicacion(),v=n.default.cpus().length,b=u.default.createServer(p);if(d.default.isPrimary){c.default.info(`Número de procesadores: ${v}`),c.default.info(`PID Máster: ${process.pid}`);for(let e=0;e<v;e++)d.default.fork();d.default.on("exit",(e=>{c.default.info(`Worker ${e.process.pid} died ${(new Date).toLocaleString()}`),d.default.fork()}))}else b.listen(f,(()=>{c.default.info(`PID Worker ${process.pid} escuchando en puerto ${f}`)})),b.on("error",(function(e){if("listen"!==e.syscall)throw e;var t="string"==typeof f?"Pipe "+f:"Port "+f;switch(e.code){case"EACCES":c.default.error(t+" requires elevated privileges"),process.exit(1);break;case"EADDRINUSE":c.default.error(t+" is already in use"),process.exit(1);break;default:throw e}})),b.on("listening",(function(){var e=b.address(),t="string"==typeof e?"pipe "+e:"port "+(null==e?void 0:e.port);(0,l.default)("Listening on "+t)}))},5095:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createHash=void 0;const i=o(r(7096));t.createHash=function(e){return i.default.hashSync(e,i.default.genSaltSync(10))}},85:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.contraseniaValida=void 0;const i=o(r(7096));t.contraseniaValida=function(e,t){return i.default.compareSync(t,e.usuarioscontrasenia)}},7096:e=>{e.exports=require("bcrypt")},3986:e=>{e.exports=require("body-parser")},7455:e=>{e.exports=require("compression")},9710:e=>{e.exports=require("cookie-parser")},3582:e=>{e.exports=require("cors")},6974:e=>{e.exports=require("debug")},5142:e=>{e.exports=require("dotenv")},6860:e=>{e.exports=require("express")},8283:e=>{e.exports=require("express-mysql-session")},6508:e=>{e.exports=require("express-session")},7806:e=>{e.exports=require("helmet")},514:e=>{e.exports=require("knex")},8094:e=>{e.exports=require("log4js")},1566:e=>{e.exports=require("minimist")},2245:e=>{e.exports=require("moment")},5001:e=>{e.exports=require("cluster")},3685:e=>{e.exports=require("http")},2037:e=>{e.exports=require("os")}},t={};!function r(o){var i=t[o];if(void 0!==i)return i.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,r),a.exports}(7728)})();